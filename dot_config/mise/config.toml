[tasks.default]
description = "Run all build tasks"
run = '''
'''

[env]
# [doc] https://github.com/jdx/mise/blob/86520c50c267fa6844326da70355534e46e043f8/docs/configuration.md?plain=1#L380
MISE_RAW = 1

[tasks."build:antidote"]
description = "Clone the cure to slow zsh plugin management"
hide = true
sources = ["$HOME/.local/share/antidote"]
outputs = { auto = true }
run = '''
	# Running...
	antidote_dir="$HOME/.local/share/antidote"
	rm -rf "$antidote_dir"
	git clone --quiet --depth=1 https://github.com/mattmc3/antidote.git "$antidote_dir"
'''

[tasks."update:chezmoi"]
description = "Update the dotfiles"
hide = true
run = '''
	# Running...
	if ! mise exec -- chezmoi source-path >/dev/null 2>&1; then
	  GITHUB_USERNAME=rick-c-137-137; mise exec -- chezmoi init --apply $GITHUB_USERNAME;
	else
	  mise exec -- chezmoi update --force
	fi
'''

[tasks."update:macos-config"]
description = "Update macOS config"
hide = true
sources = ["$HOME/.gitconfig"]
outputs = { auto = true }
run = '''
	# Running...
	defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool TRUE
	defaults write -g com.apple.mouse.scaling 20
'''

[tasks."build:global-dot-gitconfig"]
description = "Make the dotfiles"
hide = true
sources = ["$HOME/.gitconfig"]
outputs = { auto = true }
run = '''
	# Running...
	git config --global push.autoSetupRemote true
	git config --global pager.branch false
	git config --global credential.helper ""
'''

[tasks."restart:macos"]
description = "Restart macOS"
hide = true
run = '''
	#!/bin/bash
	rm -rf .zsh_sessions
	killall Runner\.Listener
	sleep 3 & exit \
	& osascript -e 'tell application "Terminal" to set mainID to id of front window' \
		-e 'tell application "Terminal" to close (every window whose id â‰  mainID) without saving' \
	& osascript -e 'tell app "System Events" to restart' \
	& echo "$(date): Restart mac successfully"  >> "$HOME/Desktop/log_restart_mac.txt"
'''




